<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Rails Girls Sinatra tutorial - Rails Girls</title>
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script src="/js/prefixfree.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
    <script src="/js/jquery.cookie.js"></script>
    <script src="/js/guides.js"></script>
    <link href="/css/bootstrap.css" rel="stylesheet" />
    <link href="/css/bootstrap-responsive.css" rel="stylesheet" />
    <link href="/css/code.css" rel="stylesheet" />
    <link href="/css/style.css" rel="stylesheet" />
    <link href="/favicon.png" rel="shortcut icon" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body>
    <header>
      <div class="container">
        <a class="span3" href="/" id="logo">
          <img alt="Rails Girls Guides" src="/images/railsgirls-guides.png" />
        </a>
        <nav></nav>
      </div>
    </header>
    <article class="container">
      <div class="span10">
        <h1 id="create-your-first-voting-app-with-sinatra">Create your first voting app with Sinatra</h1>

<p><em>Created by Piotr Szotkowski, <a href="https://twitter.com/chastell">@chastell</a></em></p>

<p>We will create a little voting app from scratch using a web development framework for Ruby called Sinatra, which is much like Ruby on Rails. Just another tool to get the job done really, and a fun one too!</p>

<p>Imagine your group of friends is figuring out what to order for your weekly movie watching marathon. With the many fast food options out there, this can become quite a discussion. This is where our app comes into play!</p>

<p><strong>COACH</strong>: Explain shortly what <a href="http://www.sinatrarb.com">Sinatra</a> is.</p>

<h2 id="install-sinatra">Install Sinatra</h2>

<p>Remember how we needed to install Ruby on Rails? Similarly we need to install Sinatra:</p>

<p><code>gem install sinatra</code></p>

<h3 id="create-your-first-sinatra-app">Create your first Sinatra app</h3>

<p>Create a <code>suffragist.rb</code> file with the following contents:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;sinatra&#39;</span>

<span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
  <span class="s1">&#39;Hello, voter!&#39;</span>
<span class="k">end</span></code></pre></div>

<p>You can actually call your Ruby file whatever you’d like. <code>vote.rb</code> for instance would totally work as well, when used consistently. But <a href="http://www.vocabulary.com/dictionary/suffragist">suffragist</a> actually references to a super important event in the women’s rights movement, so let’s just go with that for now!  </p>

<h3 id="run-your-app">Run your app</h3>

<p>Go to the directory where you put your app and run <code>ruby suffragist.rb</code>.
Now you can visit <a href="http://localhost:4567">localhost:4567</a>. You should
see a ‘Hello, voter!’ page, which means that the generation of your new
app worked correctly. Hit <code>ctrl-c</code> in the terminal to quit the server.</p>

<p><strong>COACH</strong>: Explain POST and GET methods, and how to communicate with the browser.</p>

<h3 id="add-the-index-view">Add the index view</h3>

<p>To keep everything in order let’s make
a directory for our views (and name it <code>views</code>).</p>

<p>Put this code into an <code>index.erb</code> file in the <code>views</code> directory:</p>

<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="x">&lt;html&gt;</span>
<span class="x">  &lt;head&gt;</span>
<span class="x">    &lt;meta charset=&#39;UTF-8&#39; /&gt;</span>
<span class="x">    &lt;title&gt;Suffragist&lt;/title&gt;</span>
<span class="x">    &lt;link href=&#39;//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css&#39; rel=&#39;stylesheet&#39; /&gt;</span>
<span class="x">  &lt;/head&gt;</span>
<span class="x">  &lt;body class=&#39;container&#39;&gt;</span>
<span class="x">    &lt;p&gt;What&#39;s for dinner?&lt;/p&gt;</span>
<span class="x">    &lt;form action=&#39;cast&#39; method=&#39;post&#39;&gt;</span>
<span class="x">      &lt;ul class=&#39;unstyled&#39;&gt;</span>
<span class="x">        </span><span class="cp">&lt;%</span> <span class="no">Choices</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="p">,</span> <span class="n">text</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">          &lt;li&gt;</span>
<span class="x">            &lt;label class=&#39;radio&#39;&gt;</span>
<span class="x">              &lt;input type=&#39;radio&#39; name=&#39;vote&#39; value=&#39;</span><span class="cp">&lt;%=</span> <span class="nb">id</span> <span class="cp">%&gt;</span><span class="x">&#39; id=&#39;vote_</span><span class="cp">&lt;%=</span> <span class="nb">id</span> <span class="cp">%&gt;</span><span class="x">&#39; /&gt;</span>
<span class="x">              </span><span class="cp">&lt;%=</span> <span class="n">text</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">            &lt;/label&gt;</span>
<span class="x">          &lt;/li&gt;</span>
<span class="x">        </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">      &lt;/ul&gt;</span>
<span class="x">      &lt;button type=&#39;submit&#39; class=&#39;btn btn-primary&#39;&gt;Cast this vote!&lt;/button&gt;</span>
<span class="x">    &lt;/form&gt;</span>
<span class="x">  &lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span></code></pre></div>

<p>And into <code>suffragist.rb</code>:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Choices</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;HAM&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Hamburger&#39;</span><span class="p">,</span>
  <span class="s1">&#39;PIZ&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Pizza&#39;</span><span class="p">,</span>
  <span class="s1">&#39;CUR&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Curry&#39;</span><span class="p">,</span>
  <span class="s1">&#39;NOO&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Noodles&#39;</span><span class="p">,</span>
<span class="p">}</span></code></pre></div>

<p>Change the <code>get</code> action:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
  <span class="n">erb</span> <span class="ss">:index</span>
<span class="k">end</span></code></pre></div>

<p>Run <code>ruby suffragist.rb</code>, check your
results and quit the server with <code>ctrl-c</code>.</p>

<p><strong>COACH</strong>: Talk a little about HTML and erb. Explain
templates. Explain what global constants are.</p>

<h3 id="templates">Templates</h3>

<p>Adjust the <code>index.erb</code> file in the <code>views</code>
directory and add the <code>&lt;h1&gt;…&lt;/h1&gt;</code> line:</p>

<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;body class=&#39;container&#39;&gt;</span>
<span class="x">    &lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@title</span> <span class="cp">%&gt;</span><span class="x">&lt;/h1&gt;</span>
<span class="x">    &lt;p&gt;What&#39;s for dinner?&lt;/p&gt;</span></code></pre></div>

<p>Change the <code>get</code> action:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span>
  <span class="vi">@title</span> <span class="o">=</span> <span class="s1">&#39;Welcome to the Suffragist!&#39;</span>
  <span class="n">erb</span> <span class="ss">:index</span>
<span class="k">end</span></code></pre></div>

<p><strong>COACH</strong>: Explain what instance variables are and
how Sinatra makes them visible in the views.</p>

<h3 id="add-the-ability-to-post-results">Add the ability to POST results</h3>

<p>Put this into <code>suffragist.rb</code>:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">post</span> <span class="s1">&#39;/cast&#39;</span> <span class="k">do</span>
  <span class="vi">@title</span> <span class="o">=</span> <span class="s1">&#39;Thanks for casting your vote!&#39;</span>
  <span class="vi">@vote</span>  <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="s1">&#39;vote&#39;</span><span class="o">]</span>
  <span class="n">erb</span> <span class="ss">:cast</span>
<span class="k">end</span></code></pre></div>

<p>Create a new file in the <code>views</code> directory, <code>cast.erb</code>,
and put there some HTML with embedded Ruby code:</p>

<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="x">&lt;html&gt;</span>
<span class="x">  &lt;head&gt;</span>
<span class="x">    &lt;meta charset=&#39;UTF-8&#39; /&gt;</span>
<span class="x">    &lt;title&gt;Suffragist&lt;/title&gt;</span>
<span class="x">    &lt;link href=&#39;//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css&#39; rel=&#39;stylesheet&#39; /&gt;</span>
<span class="x">  &lt;/head&gt;</span>
<span class="x">  &lt;body class=&#39;container&#39;&gt;</span>
<span class="x">    &lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@title</span> <span class="cp">%&gt;</span><span class="x">&lt;/h1&gt;</span>
<span class="x">    &lt;p&gt;You cast: </span><span class="cp">&lt;%=</span> <span class="no">Choices</span><span class="o">[</span><span class="vi">@vote</span><span class="o">]</span> <span class="cp">%&gt;</span><span class="x">&lt;/p&gt;</span>
<span class="x">    &lt;p&gt;&lt;a href=&#39;/results&#39;&gt;See the results!&lt;/a&gt;&lt;/p&gt;</span>
<span class="x">  &lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span></code></pre></div>

<p><strong>COACH</strong>: Explain how POST works. How to catch what
was sent in the form? Where do <code>params</code> come from?</p>

<h3 id="factor-out-a-common-layout">Factor out a common layout</h3>

<p>Create a <code>layout.erb</code> file in the <code>views</code>
directory. Put the following in there:</p>

<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;!DOCTYPE html&gt;</span>
<span class="x">&lt;html&gt;</span>
<span class="x">  &lt;head&gt;</span>
<span class="x">    &lt;meta charset=&#39;UTF-8&#39; /&gt;</span>
<span class="x">    &lt;title&gt;Suffragist&lt;/title&gt;</span>
<span class="x">    &lt;link href=&#39;//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css&#39; rel=&#39;stylesheet&#39; /&gt;</span>
<span class="x">  &lt;/head&gt;</span>
<span class="x">  &lt;body class=&#39;container&#39;&gt;</span>
<span class="x">    &lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@title</span> <span class="cp">%&gt;</span><span class="x">&lt;/h1&gt;</span>
<span class="x">    </span><span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  &lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span></code></pre></div>

<p>Remove the above part from the other two templates
(<code>index.erb</code> and <code>cast.erb</code> in the <code>views</code> directory).</p>

<p><strong>COACH</strong>: Talk about the structure of HTML documents and how factoring
out common code work in general. Explain what <code>yield</code> does.</p>

<h3 id="add-the-results-route-and-the-results-view">Add the results route and the results view</h3>

<p>Paste the following code into <code>suffragist.rb</code>:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">get</span> <span class="s1">&#39;/results&#39;</span> <span class="k">do</span>
  <span class="vi">@votes</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;waw&#39;</span> <span class="o">=&gt;</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;krk&#39;</span> <span class="o">=&gt;</span> <span class="mi">5</span> <span class="p">}</span>
  <span class="n">erb</span> <span class="ss">:results</span>
<span class="k">end</span></code></pre></div>

<p>Create a new file in the <code>views</code> directory, called <code>results.erb</code>.</p>

<div class="highlight"><pre><code class="language-erb" data-lang="erb"><span class="x">&lt;table class=&#39;table table-hover table-striped&#39;&gt;</span>
<span class="x">  </span><span class="cp">&lt;%</span> <span class="no">Choices</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="p">,</span> <span class="n">text</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">    &lt;tr&gt;</span>
<span class="x">      &lt;th&gt;</span><span class="cp">&lt;%=</span> <span class="n">text</span> <span class="cp">%&gt;</span><span class="x">&lt;/th&gt;</span>
<span class="x">      &lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@votes</span><span class="o">[</span><span class="nb">id</span><span class="o">]</span> <span class="o">||</span> <span class="mi">0</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">      &lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="s1">&#39;#&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="vi">@votes</span><span class="o">[</span><span class="nb">id</span><span class="o">]</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="x">&lt;/td&gt;</span>
<span class="x">    &lt;/tr&gt;</span>
<span class="x">  </span><span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;/table&gt;</span>
<span class="x">&lt;p&gt;&lt;a href=&#39;/&#39;&gt;Cast more votes!&lt;/a&gt;&lt;/p&gt;</span></code></pre></div>

<p>Run <code>ruby suffragist.rb</code>, check
your results and quit the server with <code>ctrl-c</code>.</p>

<p><strong>COACH</strong>: Explain HTML tables and how how the
missing values from the hash default to zero.</p>

<h3 id="persist-the-results-using-yamlstore">Persist the results using YAML::Store</h3>

<p>Time for something new! Let’s store our choices.</p>

<p>Add the following to the top of <code>suffragist.rb</code>:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;yaml/store&#39;</span></code></pre></div>

<p>Add some more code into <code>suffragist.rb</code> – replace
<code>post '/cast'</code> and <code>get '/results'</code> with the following:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">post</span> <span class="s1">&#39;/cast&#39;</span> <span class="k">do</span>
  <span class="vi">@title</span> <span class="o">=</span> <span class="s1">&#39;Thanks for casting your vote!&#39;</span>
  <span class="vi">@vote</span>  <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="s1">&#39;vote&#39;</span><span class="o">]</span>
  <span class="vi">@store</span> <span class="o">=</span> <span class="no">YAML</span><span class="o">::</span><span class="no">Store</span><span class="o">.</span><span class="n">new</span> <span class="s1">&#39;votes.yml&#39;</span>
  <span class="vi">@store</span><span class="o">.</span><span class="n">transaction</span> <span class="k">do</span>
    <span class="vi">@store</span><span class="o">[</span><span class="s1">&#39;votes&#39;</span><span class="o">]</span> <span class="o">||=</span> <span class="p">{}</span>
    <span class="vi">@store</span><span class="o">[</span><span class="s1">&#39;votes&#39;</span><span class="o">][</span><span class="vi">@vote</span><span class="o">]</span> <span class="o">||=</span> <span class="mi">0</span>
    <span class="vi">@store</span><span class="o">[</span><span class="s1">&#39;votes&#39;</span><span class="o">][</span><span class="vi">@vote</span><span class="o">]</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="k">end</span>
  <span class="n">erb</span> <span class="ss">:cast</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">&#39;/results&#39;</span> <span class="k">do</span>
  <span class="vi">@title</span> <span class="o">=</span> <span class="s1">&#39;Results so far:&#39;</span>
  <span class="vi">@store</span> <span class="o">=</span> <span class="no">YAML</span><span class="o">::</span><span class="no">Store</span><span class="o">.</span><span class="n">new</span> <span class="s1">&#39;votes.yml&#39;</span>
  <span class="vi">@votes</span> <span class="o">=</span> <span class="vi">@store</span><span class="o">.</span><span class="n">transaction</span> <span class="p">{</span> <span class="vi">@store</span><span class="o">[</span><span class="s1">&#39;votes&#39;</span><span class="o">]</span> <span class="p">}</span>
  <span class="n">erb</span> <span class="ss">:results</span>
<span class="k">end</span></code></pre></div>

<p><strong>COACH</strong>: Explain what YAML is.</p>

<h3 id="see-how-the-yaml-file-changes-when-votes-are-cast">See how the YAML file changes when votes are cast</h3>

<p>Let’s open <code>votes.yml</code>. And vote. And check again.</p>

<p><strong>COACH</strong>: There will be situations when one or more students will
forget to quit the server before running it again. It’s a good
opportunity to search the Internet for a solution. They don’t
have to know everything about killing processes to find a solution.</p>

<p><strong>COACH</strong>: In the end explain shortly the differences between Sinatra and Rails.</p>

<h2 id="play-with-the-app">Play with the app</h2>

<p>Try to change things in the app in any way you see fit:</p>

<ul>
  <li>Add some additional logic to the views.</li>
  <li>Redirect to the results outright.</li>
  <li>Add other votings; how would the YAML file need to change?</li>
  <li>Try to style the file in different ways.</li>
</ul>

      </div>
    </article>
    <footer>
      <p>
        This work is licensed under a
        <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-Share Alike 3.0 License</a>
      </p>
      <p>
        <a href="http://railsgirls.com">Rails Girls</a>
        &middot; Crafted with excitement from Helsinki, Finland &middot; Follow us on
        <a href="http://twitter.com/railsgirls">Twitter</a>
        and
        <a href="https://www.facebook.com/railsgirls">Facebook</a>
      </p>
    </footer>
    <script type="text/javascript">
      //<![CDATA[
        var _gaq = _gaq || [];
        _gaq.push(["_setAccount", "UA-19631067-3"]);
        _gaq.push(["_trackPageview"]);

        (function() {
          var ga = document.createElement("script"); ga.type = "text/javascript"; ga.async = true;
          ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";
          var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ga, s);
        })();
      //]]>
    </script>
  </body>
</html>
