<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Test ứng dụng với RSpec - Rails Girls</title>
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script src="/js/prefixfree.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
    <script src="/js/jquery.cookie.js"></script>
    <script src="/js/guides.js"></script>
    <link href="/css/bootstrap.css" rel="stylesheet" />
    <link href="/css/bootstrap-responsive.css" rel="stylesheet" />
    <link href="/css/code.css" rel="stylesheet" />
    <link href="/css/style.css" rel="stylesheet" />
    <link href="/favicon.png" rel="shortcut icon" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body>
    <header>
      <div class="container">
        <a class="span3" href="/" id="logo">
          <img alt="Rails Girls Guides" src="/images/railsgirls-guides.png" />
        </a>
        <nav></nav>
      </div>
    </header>
    <article class="container">
      <div class="span10">
        <h1 id="test-ng-dng-vi-rspec">Test ứng dụng với RSpec</h1>

<p><em>Viết bởi Clemens Helm, <a href="https://twitter.com/clemenshelm">@clemenshelm</a> and Floor Drees, <a href="https://twitter.com/floordrees">@floordrees</a></em></p>

<p>RSpec là một framework test cho Ruby, nó mô tả các hành vi của ứng dụng bằng một loại cú pháp không giống cú pháp của Ruby cho lắm. RSpec output kết quả test ra terminal nên bạn cũng sẽ được test kĩ năng đọc của mình luôn .</p>

<p><strong>Huấn luyện viên</strong>: Nói về test phần mềm và Behavior-Driven Development (BDD).</p>

<h2 id="ci-t-rspec">Cài đặt RSpec</h2>

<p>Để bắt đầu, chúng ta hãy cùng cài đặt RSpec và các dependencies của nó:</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">gem install rspec</code></pre></div>

<p>Sau đó chạy:</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">rspec --init</code></pre></div>

<p>trong thư mục của dự án đang làm. Lệnh này sẽ tạo ra tệp tin <code>spec_helper.rb</code> trong thư mục <code>spec</code>, và tệp tin <code>.rspec</code>.</p>

<p>Rubyists (các lập trình viên Ruby) thường sử dụng hai từ “test” và “đặc tả kĩ thuật” (specification) thay thế qua lại, vì thế các test thường được lưu trữ trong thư mục <code>specs</code>. Lưu test bạn vừa viết với tên <code>idea_spec.rb</code> (<code>&lt;name_of_spec&gt;_spec.rb</code>).</p>

<p>Trong tệp tin mới vừa tạo, nhập:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s2">&quot;spec_helper&quot;</span>
<span class="nb">require</span> <span class="s2">&quot;idea&quot;</span></code></pre></div>

<p>Tiếp theo hãy mô tả một trong số các đặc tả kĩ thuật (specification)</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">describe</span> <span class="no">Idea</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s2">&quot;has a title&quot;</span> <span class="c1"># your examples (tests) go here</span>
<span class="k">end</span></code></pre></div>

<p>Trong terminal chạy:</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh">rspec spec/lib/idea_spec.rb</code></pre></div>

<p>Lệnh này sẽ output rằng test của bạn đang ở trạng thái <code>pending</code> vì bạn chưa triển khai test.</p>

<p><strong>Huấn luyện viên</strong>: Nói về googling (tìm kiếm bằng Google) các output từ terminal.</p>

<p>Hãy cùng triển khai test case đầu tiên:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">describe</span> <span class="no">Idea</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s2">&quot;has a title&quot;</span> <span class="k">do</span> <span class="c1"># yep, you can totally use &#39;it&#39;</span>
    <span class="n">idea</span> <span class="o">=</span> <span class="no">Idea</span><span class="o">.</span><span class="n">new</span> <span class="c1"># creating a new idea &#39;instance&#39;</span>
    <span class="n">idea</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">should</span> <span class="n">be_true</span> <span class="c1"># this is our expectation</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>Chạy lại lệnh phía trên sẽ cho ra output thỏa mãn mục tiêu của bạn.</p>

<h3 id="refactoring">Refactoring</h3>

<p>Bạn có thể viết như sau:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">describe</span> <span class="no">Idea</span> <span class="k">do</span>
  <span class="n">its</span><span class="p">(</span><span class="ss">:title</span><span class="p">)</span> <span class="p">{</span> <span class="n">should</span> <span class="n">be_true</span> <span class="p">}</span>
<span class="k">end</span></code></pre></div>

<p>trông sẽ đẹp hơn rất nhiều, mặc dù có rất nhiều “phép màu” xảy ra ở đoạn code này. Hiện tại, bạn không cần quan tâm nhiều đến những “phép màu” đó, hãy vui vẻ vì chúng ta có thể “refactor” những đoạn code dài thành những đoạn nhỏ đẹp đẽ chỉ với một chút kinh nghiệm.</p>

<p><strong>Huấn luyện viên</strong>: Nói một chút về refactoring.</p>

<h3 id="nh-du-cc-test">Đánh dấu các test</h3>

<p>Giống như to-do lists, có những test case bạn chưa muốn triển khai ngay. RSpec có một tính năng tiện lợi giúp bạn đánh dấu trạng thái <code>pending</code> cho các test cụ thể.</p>

<p>Bỏ <code>do</code> và <code>end</code> khỏi nội dung của test case như sau</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">it</span> <span class="s2">&quot;has a title&quot;</span></code></pre></div>

<p>sẽ đánh dấu test case đó ở trạng thái pending. Với các ứng dụng lớn hơn, khi mà bạn chỉ muốn xử lí từng test mỗi lần, bạn có thể thêm kí tự <code>x</code> trước test case như sau:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">describe</span> <span class="no">Idea</span> <span class="k">do</span>
  <span class="n">xit</span> <span class="s2">&quot;has a title&quot;</span> <span class="k">do</span>
<span class="k">end</span></code></pre></div>

<p>hoặc dùng từ <code>pending</code> trong test case.</p>

<h2 id="behavior-driven-development-bdd">Behavior-Driven Development (BDD)</h2>

<p>Thường thì chúng ta sẽ thực hiện BDD testing hơi khác một chút. Suy nghĩ về ứng dụng chúng ta muốn xây dựng, chúng ta sẽ viết những kì vọng của chúng ta về ứng dụng trước rồi bắt đầu xây dựng từng bước, với các đặc tả kĩ thuật trong đầu.</p>

<p>Ban đầu chúng ta viết</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">describe</span> <span class="no">Idea</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s2">&quot;has a title&quot;</span>
    <span class="n">idea</span> <span class="o">=</span> <span class="no">Idea</span><span class="o">.</span><span class="n">new</span>
    <span class="n">idea</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">should</span> <span class="n">be_true</span>
    <span class="c1"># or, alternatively: idea.title.should == true</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>

<p>và sau đó tạo tệp tin <code>idea.rb</code> khai báo class <code>Idea </code></p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Idea</span>
<span class="kp">attr_accessor</span>  <span class="ss">:title</span>
<span class="k">end</span></code></pre></div>

<p>vì chạy <code>rspec spec/lib/idea_spec.rb</code> trong terminal trước khi tạo class <code>Idea</code> sẽ output ra lỗi.  May mắn là các lỗi không phải là thứ gì đáng sợ. Lỗi trong RSpec thực tế giúp bạn viết các đoạn code cần thiết.</p>

<p>Hãy thử viết test cho các hướng dẫn tiếp theo để kiểm tra xem bạn có triển khai đúng TẤT CẢ mọi thứ không.</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">describe</span> <span class="no">Attendee</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s2">&quot;tests everything&quot;</span>
<span class="k">end</span></code></pre></div>

<p>Nói vậy thôi :D</p>

<p>Happy testing!</p>

      </div>
    </article>
    <footer>
      <p>
        This work is licensed under a
        <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-Share Alike 3.0 License</a>
      </p>
      <p>
        <a href="http://railsgirls.com">Rails Girls</a>
        &middot; Crafted with excitement from Helsinki, Finland &middot; Follow us on
        <a href="http://twitter.com/railsgirls">Twitter</a>
        and
        <a href="https://www.facebook.com/railsgirls">Facebook</a>
      </p>
    </footer>
    <script type="text/javascript">
      //<![CDATA[
        var _gaq = _gaq || [];
        _gaq.push(["_setAccount", "UA-19631067-3"]);
        _gaq.push(["_trackPageview"]);

        (function() {
          var ga = document.createElement("script"); ga.type = "text/javascript"; ga.async = true;
          ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";
          var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ga, s);
        })();
      //]]>
    </script>
  </body>
</html>
